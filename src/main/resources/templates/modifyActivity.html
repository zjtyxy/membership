<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>

    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>活动页面</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <link rel="stylesheet" href="assets/materialize/css/materialize.min.css" media="screen,projection"/>
    <!-- Bootstrap Styles-->
    <link href="assets/css/bootstrap.css" rel="stylesheet"/>
    <!-- FontAwesome Styles-->
    <link href="assets/css/font-awesome.css" rel="stylesheet"/>
    <!-- Morris Chart Styles-->
    <link href="assets/js/morris/morris-0.4.3.min.css" rel="stylesheet"/>
    <!-- Custom Styles-->
    <link href="assets/css/custom-styles.css" rel="stylesheet"/>
    <style>
        .modal {
            background-color: #76767600;
            box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.0);
            height: 100%;
        }

        .contents {
                border: 1px solid #000;
                margin-left: 25px;
                margin-top: 10px;
                width: 96%;
            }
        .contents1 {
            border: 1px solid #aa00ff;
            margin-left: 25px;
            margin-top: 10px;
            width: 96%;
        }
    </style>
</head>

<body>

<div id="wrapper">
    <div th:replace="title :: html"></div>
    <!--侧边栏-->
    <div th:replace="sidebar :: html"></div>
    <!--内容主体-->
    <div id="page-wrapper">
        <!--内容主题-->
        <div class="header">
            <h1 class="page-header">
                活动页面
            </h1>
        </div>
        <div id="page-inner">
            <!--自定义内容-->
            <!--<div class="container">-->
            <div class="card">
                <div class="card-content">
                    <form th:action="@{/modifyActivity}" method="post" id="modifyActivity" th:object="${entity}">
                        <input id="idx" name="id" type="hidden" class="validate" th:value="*{getId()}" required/>
                        <div class="row">
                            <div class="form-group" style="width: 48%;float: left;padding-left: 20px">
                                <label for="name">活动名称</label>
                                <input id="name" name="name" type="text" class="validate" placeholder="活动名称"
                                       th:value="*{getName()}" required/>
                            </div>
                            <div class="form-group" style="width: 48%;float: left;padding-left: 20px">
                                <label for="link">主页图片地址</label>
                                <input id="link" name="link" type="text" class="validate"
                                       placeholder="主页图片地址" th:value="*{getLink()}" required/>
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group" style="width: 48%;float: left;padding-left: 20px">
                                <label for="userName">最大参加人数</label>
                                <input id="maxNumber"  class="validate" th:field="*{maxNumber}"
                                       placeholder="发布者" required/>
                            </div>
                            <div class="form-group" style="width: 48%;float: left;padding-left: 20px">
                                <label for="signupMode">报名方式</label>
                                <input placeholder="报名方式" id="signupMode" class="validate"
                                        th:field="*{signupMode}" required/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group" style="width: 48%;float: left;padding-left: 20px">
                                <label for="endDate">报名截止日</label>
                                <input id="endDate" type="date" class="validate" name="endDate" th:value="*{endDate}"
                                       placeholder="报名截止日" required/>
                            </div>
                            <div class="form-group" style="width: 48%;float: left;padding-left: 20px">
                                <label for="days">活动天数</label>
                                <input placeholder="活动天数" id="days" class="validate"
                                       th:field="*{days}" required/>
                            </div>
                        </div>


                        <div class="row">
                            <div class="form-group" style="width: 48%;float: left;padding-left: 20px">
                                <label for="money">活动费用</label>
                                <input placeholder="活动费用" id="money" t class="validate"
                                      th:field="*{money}" required/>
                            </div>
                            <div class="form-group" style="width: 48%;float: left;padding-left: 20px">
                                <label for="userName">发布者</label>
                                <input id="userName" name="userName" type="text" class="validate" th:field="*{userName}"
                                       placeholder="发布者" required/>
                            </div>

                        </div>
                        <div class="contents1">
                            <div class="row">
                                <div class="form-group" style="width: 100%;float: left;padding-left: 20px">
                                    <label>活动日程</label>
                                    <button type="button" onclick="showDayTrip()" data-toggle="modal"
                                            data-target="#tripModal">添加日程
                                    </button>
                                    <button type="button" onclick="removeDayTrip()">删除行程
                                    </button>
                                </div>
                            </div>
                            <div class="row" id="daytrip">
                                <div class="contents" th:id="'tdaytrip'+${statx.count}"
                                     th:each="stat,statx:*{getRoutingday()}">
                                    <label placeholder="日程" type="text" th:text="'第'+${stat.key}+'天'"/>
                                    <button type="button" onclick="showDayTrip(this)" data-toggle="modal"
                                            data-target="#tripModal">查看
                                    </button>
                                    <input placeholder="日程介绍" class="validate"
                                           th:field="*{routingday[__${stat.key}__].title}"/>

                                    <div class="contents"  th:id="'daytripContent'+${statx.count}" th:each="dayentity:${stat.value.content}">
                                        <label type="text" th:text="${dayentity.key}"></label>
                                        <input   class="validate" th:field="*{routingday[__${stat.key}__].content[__${dayentity.key}__]}"/>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="contents1">
                            <div class="row">
                                <div class="form-group" style="width: 100%;float: left;padding-left: 20px">
                                    <label>增值项目</label>
                                    <button type="button" data-toggle="modal" data-target="#myModal">添加项目
                                    </button>
                                </div>
                            </div>
                            <div class="row" id="project">
                                <div class="contents"
                                     th:each="stat:*{getIncrement()}">

                                    <label placeholder="项目名称" id="increment.key" type="text" th:text="${stat.key}"/>
                                    <button type="button" onclick="removeServer(this)">删除</button>
                                    <input placeholder="项目描述" class="validate"
                                           th:field="*{increment[__${stat.key}__]}"/>
                                </div>

                            </div>

                        </div>
                        <div class="contents1">
                            <div class="row">
                                <div class="form-group" style="width: 100%;float: left;padding-left: 20px">
                                    <label>活动图片列表</label>
                                    <button onclick="addImageUrl()" type="button">添加图片
                                    </button>
                                </div>
                            </div>
                            <div class="row" id="imgurllist">
                                <div class="contents"
                                     th:each="stat:*{getImageurls()}">
                                    <button type="button" onclick="removeImage(this)">删除</button>
                                    <input placeholder="活动图片" id="imageurls" type="text" class="validate"
                                           name="imageurls" th:value="${stat}" required/>
                                </div>

                            </div>

                        </div>

                        <div class="row">

                            <button onclick="submitForm()" class="waves-effect waves-light btn" type="button">确认修改
                            </button>
                        </div>
                    </form>

                    <div class="clearBoth"></div>
                </div>
                <!--</div>-->
            </div>
            <!--页脚-->
            <br>
            <br>
            <br>
            <div th:replace="footer :: html"></div>
        </div>

    </div>
</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div role="document">
        <div>
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h5 class="modal-title" id="myModalLabel">添加增值服务</h5>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="serverName">服务名称</label>
                    <input type="text" class="form-control" id="serverName" placeholder="服务名称">
                </div>
                <div class="form-group">
                    <label for="serverDesc">服务介绍</label>
                    <input type="text" class="form-control" id="serverDesc" placeholder="服务介绍">
                </div>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn waves-effect waves-light" onclick="addServer()" data-dismiss="modal">
                    保存修改
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="tripModal" tabindex="-1" role="dialog" ondrop="tripclose()">
    <div role="document">
        <div>
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h5 class="modal-title">添加<span id="currentDay"></span>活动日程</h5>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="serverName">日程标题</label>
                    <input type="text" class="form-control" id="tripTitle" placeholder="日程标题">
                </div>
                <div>
                    <div class="row">
                        <div class="form-group" style="width: 100%;float: left;padding-left: 20px">
                            <label>日程内容</label>
                            <button type="button" onclick="addContent(-1,'','')">添加
                            </button>
                        </div>
                    </div>
                    <div class="row" id="daytripcontent">

                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn waves-effect waves-light" onclick="addDayTrip()" data-dismiss="modal">
                    保存修改
                </button>
            </div>
        </div>
    </div>
</div>
<!-- JS Scripts-->
<!-- jQuery Js -->
<script src="assets/js/jquery-1.10.2.js"></script>

<!-- Bootstrap Js -->
<script src="assets/js/bootstrap.min.js"></script>

<script src="assets/materialize/js/materialize.min.js"></script>

<!-- Metis Menu Js -->
<script src="assets/js/jquery.metisMenu.js"></script>

<script src="assets/js/easypiechart.js"></script>
<script src="assets/js/easypiechart-data.js"></script>

<script src="assets/js/Lightweight-Chart/jquery.chart.js"></script>

<!-- Custom Js -->
<script src="assets/js/custom-scripts.js"></script>

<script th:inline="javascript">
    function submitForm() {
        $('#modifyActivity').submit();
    }

    function addImageUrl() {
        var htmlstr = '<div class="contents">\n' +
            '            <input placeholder="活动图片" id="imageurls" type="text" class="validate" name="imageurls" />\n' +
            '            </div>'
        $('#imgurllist').append(htmlstr);
    }

    function removeImage(btn) {
        $(btn).parent().remove();
    }

    function addContent(cindex, t, c) {
        if (cindex == -1) {
            cindex = tripdaycontent[tripday]++;
        }
        var htmlstr = '<div class="contents">\n' +
            '<label >活动标题</label>' +
            '            <input placeholder="标题" id="contentTitle' + (cindex) + '" type="text"  value="' + t + '" class="validate" style="width: 96%" />\n' +
            '<label >活动内容</label>' +
            '            <input placeholder="内容" id="contentDesc' + (cindex) + '" type="text" value="' + c + '" class="validate" style="width: 96%" />\n' +
            '            </div>'
        $('#daytripcontent').append(htmlstr);
    }

    function addServer() {
        var name = $('#serverName').val();
        var desc = $('#serverDesc').val();
        var htmlstr = '<div class="contents">\n' +
            '            <label placeholder="项目名称" id="increment.key" type="text">' + name + '</label>\n' +
                '<button type="button" onclick="removeServer(this)">删除</button>'+
            ' <input placeholder="项目介绍" id="increment" type="text" class="validate" name="increment[' + name
            + ']" value="' + desc + '"/>\n' +
            '            </div>'
        $('#project').append(htmlstr);
    }

    var tripday = [[${entity.getRoutingday().size()}]];
    var tripdaycontent = {};
    function removeDayTrip() {
        tripday=$('#daytrip').children().length;
        $('#tdaytrip'+tripday).remove();
        tripday=$('#daytrip').children().length;
    }
    function removeServer(btn) {
        $(btn).parent().remove();
    }
    function showDayTrip(isnew) {
        $('#daytripcontent').empty();
        if (!isnew)//是不是新添加
        {
            tripday=$('#daytrip').children().length+1;
            tripdaycontent[tripday] = 0;
            $('#tripTitle').val("");
        }
        else {
            var info = $(isnew).parent().children();
            tripday = info[0].textContent.replace("第", "").replace("天", "");
            $('#tripTitle').val($(info[2]).val());
            var cccc = $('#daytripContent' + tripday).children();
            tripdaycontent[tripday] = cccc.length/2;
            for (var i = 0; i < cccc.length; i+=2) {
                addContent(i, cccc[i].textContent, $(cccc[i+1]).val())
            }
        }

        $('#currentDay').html("第" + (tripday) + "天");
    }

    function addDayTrip() {

        var name = $('#tripTitle').val();
        var sd =$('#tdaytrip'+tripday);
        var htmlstr = '<div id ="tdaytrip'+tripday+'" class="form-group" style="width: 96%;float: left;padding-left: 20px">\n' +
            '<label type="text">第' + tripday + '天</label>' +
            '<button type="button" onclick="showDayTrip(this)" data-toggle="modal"data-target="#tripModal">查看 </button>' +
            '<input placeholder="日程介绍" id="increment" type="text" class="validate" name="routingday[' + tripday
            + '].title" value="' + name + '"/>\n' + '<div class="contents" id="daytripContent' + tripday + '">';
        if(sd.length>0)//是更新
        {
            $(sd).empty();
            htmlstr ='<label type="text">第' + tripday + '天</label>' +
                '<button type="button" onclick="showDayTrip(this)" data-toggle="modal"data-target="#tripModal">查看 </button>' +
                '<input placeholder="日程介绍" id="increment" type="text" class="validate" name="routingday[' + tripday
                + '].title" value="' + name + '"/>\n' + '<div class="contents" id="daytripContent' + tripday + '">';
            for (var i = 0; i < tripdaycontent[tripday]; i++) {
                htmlstr +=   '<label type="text">'+ $('#contentTitle' + i).val()+'</label>'+
                    '<input  id="increment" type="text" class="validate" name="routingday[' + tripday
                    + '].content[' + $('#contentTitle' + i).val() + ']" value="' + $('#contentDesc' + i).val() + '"/>\n';
            }
            htmlstr += ' </div>'
            $(sd).append(htmlstr);
        }
        else
        {
            htmlstr = '<div id ="tdaytrip'+tripday+'" class="form-group" style="width: 96%;float: left;padding-left: 20px">\n' +
                '<label type="text">第' + tripday + '天</label>' +
                '<button type="button" onclick="showDayTrip(this)" data-toggle="modal"data-target="#tripModal">查看 </button>' +
                '<input placeholder="日程介绍" id="increment" type="text" class="validate" name="routingday[' + tripday
                + '].title" value="' + name + '"/>\n' + '<div class="contents" id="daytripContent' + tripday + '">';
            for (var i = 0; i < tripdaycontent[tripday]; i++) {
                htmlstr +=   '<label type="text">'+ $('#contentTitle' + i).val()+'</label>' +
                    '<input  type="text" class="validate" name="routingday[' + tripday
                    + '].content[' + $('#contentTitle' + i).val() + ']" value="' + $('#contentDesc' + i).val() + '"/>\n';
            }
            htmlstr += ' </div>'
            htmlstr += ' </div>'
            $('#daytrip').append(htmlstr);
        }

    }


</script>
</body>

</html>